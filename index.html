<!doctype html>
<html>
    <head>
        <title>Internet Radio</title>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>
    </head>
    <body>
        <div id='timeline'></div>
        <script>
            var sources = [
              {audio: 'my.mp3', image: 'honor.jpg'},
              {audio: 'my2.mp3', image: 'lucifer.jpg'},
              {audio: 'my3.mp3', image: 'photo.jpg'},
              {audio: 'my4.mp3', image: 'syrup.jpg'}
            ];
            var sourceIndex = 0;

            for (var i = 0; i < sources.length; i++) {
              $('#timeline').append("<img src='img/"+ sources[i]['image'] + "'/>");
            }

            // Create an <audio> element dynamically.
            var audio = new Audio();
            audio.src = 'audio/' + sources[sourceIndex]['audio'];
            audio.autoplay = true;
            audio.loop = true;

            var context = new AudioContext();

            // Wait for window.onload to fire. See crbug.com/112368
            window.addEventListener('load', function(e) {
              var source = context.createMediaElementSource(audio);
              source.connect(context.destination);
            }, false);

            $(function() {
                $( window ).scroll(function() {
                  var bandHeight = $('#timeline').height() / sources.length;
                  var newSourceIndex = Math.floor(($(document).scrollTop() + bandHeight/2) / bandHeight);
                  if(sourceIndex != newSourceIndex)
                  {
                    sourceIndex = newSourceIndex;
                    audio.src = 'audio/' + sources[sourceIndex]['audio'];
                  }
                  console.log(sourceIndex);
                });
            });
        </script>
        <style>

          #timeline {
            display: block;
            width: 100%;
          }
          #timeline img {
            width: 100%;
            height: 100vh;
          }
        </style>
    </body>
</html>
